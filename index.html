<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Futebol de Ter√ßa</title>
<style>
:root {
    --green: #2e7d32;
    --green2: #388e3c;
    --primary: #1a73e8;
    --danger: #d32f2f;
    --bg: #f0f2f5;
    --white: #ffffff;
    --text: #222;
    --radius: 8px;
}
* { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
body { background: var(--bg); color: var(--text); min-height: 100vh; }

/* ===== HEADER ===== */
header {
    background: var(--white);
    padding: 10px 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.12);
    position: sticky; top: 0; z-index: 200;
}
.header-title {
    display: flex; align-items: center; gap: 8px;
    font-size: 1.1rem; font-weight: 700; color: var(--green);
    margin-bottom: 8px;
}
.header-controls {
    display: flex; flex-wrap: wrap; gap: 6px; align-items: center;
}
.btn {
    padding: 7px 12px; border: none; border-radius: var(--radius);
    cursor: pointer; font-weight: 600; font-size: 0.82rem;
    transition: 0.2s; white-space: nowrap;
}
.btn-primary  { background: var(--primary); color: #fff; }
.btn-green    { background: var(--green); color: #fff; }
.btn-outline  { background: #fff; border: 2px solid var(--primary); color: var(--primary); }
.btn-outline.active { background: var(--primary); color: #fff; }
.btn-danger   { background: var(--danger); color: #fff; }
.btn-sm       { padding: 4px 8px; font-size: 0.75rem; }
.btn-icon     { padding: 5px 8px; font-size: 0.8rem; }

input[type="text"], input[type="number"], select {
    padding: 7px 9px; border: 1px solid #ccc; border-radius: var(--radius);
    font-size: 0.85rem; width: 100%;
}
label { font-size: 0.8rem; font-weight: 600; color: #555; display: block; margin-bottom: 3px; }

/* ===== TABS (MOBILE NAV) ===== */
.tabs {
    display: flex;
    background: var(--white);
    border-bottom: 2px solid #e0e0e0;
    /* REMOVIDO position: sticky para n√£o cobrir os bot√µes */
}
.tab-btn {
    flex: 1; padding: 10px 4px; border: none; background: none;
    font-size: 0.78rem; font-weight: 600; cursor: pointer; color: #888;
    border-bottom: 3px solid transparent; transition: 0.2s;
}
.tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); }

/* ===== PANELS ===== */
.panel { display: none; padding: 12px; }
.panel.active { display: block; }

/* ===== CADASTRO ===== */
.card {
    background: var(--white); border-radius: var(--radius);
    box-shadow: 0 1px 4px rgba(0,0,0,0.08); padding: 14px; margin-bottom: 12px;
}
.card h4 { font-size: 0.95rem; margin-bottom: 10px; color: var(--green); }
.form-row { display: flex; gap: 8px; flex-wrap: wrap; }
.form-group { display: flex; flex-direction: column; gap: 4px; flex: 1; min-width: 120px; }
.btn-row { display: flex; gap: 8px; margin-top: 8px; }

/* Lista de jogadores */
.player-item {
    display: flex; align-items: center; gap: 10px;
    padding: 8px 0; border-bottom: 1px solid #f0f0f0;
}
.player-item:last-child { border-bottom: none; }
.avatar-sm {
    width: 36px; height: 36px; border-radius: 50%;
    object-fit: cover; border: 2px solid var(--primary); flex-shrink: 0;
}
.player-info { flex: 1; }
.player-info strong { font-size: 0.88rem; display: block; }
.player-info small  { font-size: 0.75rem; color: #777; }
.player-actions { display: flex; gap: 4px; }

/* ===== CAMPO ===== */
#panelField { padding: 8px; }

.field-controls {
    background: var(--white); border-radius: var(--radius);
    padding: 10px 12px; margin-bottom: 8px;
    display: flex; flex-wrap: wrap; gap: 8px; align-items: center;
    box-shadow: 0 1px 4px rgba(0,0,0,0.08);
}
.field-controls span { font-size: 0.82rem; font-weight: 600; }

/* Campo de futebol */
.pitch-wrap {
    position: relative; width: 100%;
    padding-top: 130%; /* retrato (vertical) no mobile */
    border-radius: 6px; overflow: hidden;
    border: 4px solid #fff;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
}
.pitch-inner {
    position: absolute; inset: 0;
    background: var(--green2);
    background-image:
        repeating-linear-gradient(
            90deg,
            rgba(0,0,0,0.04) 0px, rgba(0,0,0,0.04) 40px,
            transparent 40px, transparent 80px
        );
    display: flex;
    flex-direction: column; /* times empilhados no mobile */
}

/* Linha do meio (2 times) */
.pitch-inner::after {
    content: '';
    position: absolute;
    left: 0; right: 0;
    top: 50%; height: 2px;
    background: rgba(255,255,255,0.7);
    pointer-events: none;
}
/* C√≠rculo central */
.pitch-inner::before {
    content: '';
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%,-50%);
    width: 60px; height: 60px;
    border: 2px solid rgba(255,255,255,0.7);
    border-radius: 50%;
    pointer-events: none;
    z-index: 1;
}

/* 3 times = linha vertical */
.pitch-inner.three-teams::after {
    top: 0; bottom: 0; left: 33.33%;
    right: auto; width: 2px; height: auto;
}
.pitch-inner.three-teams::before { display: none; }
.pitch-inner.three-teams .mid-line {
    position: absolute;
    top: 0; bottom: 0; left: 66.66%;
    width: 2px; background: rgba(255,255,255,0.7);
    pointer-events: none;
}

.team-zone {
    position: relative;
    flex: 1;
    border-bottom: 2px dashed rgba(255,255,255,0.3);
    min-height: 0;
    transition: background 0.2s;
}
.team-zone:last-child { border-bottom: none; }
.team-zone.dragover { background: rgba(255,255,255,0.15); }

/* 3 times: zonas lado a lado (desktop e tablet) */
.pitch-inner.three-teams { flex-direction: row; }
.pitch-inner.three-teams .team-zone {
    border-bottom: none;
    border-right: 2px dashed rgba(255,255,255,0.3);
}
.pitch-inner.three-teams .team-zone:last-child { border-right: none; }

.team-label {
    position: absolute; top: 4px; left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.35); color: #fff;
    font-size: 0.72rem; font-weight: 700;
    padding: 2px 10px; border-radius: 20px;
    white-space: nowrap; pointer-events: none; z-index: 5;
}

/* Player card no campo */
.pcard {
    position: absolute;
    width: 52px;
    display: flex; flex-direction: column; align-items: center;
    cursor: grab; user-select: none; z-index: 10;
    touch-action: none;
}
.pcard:active { cursor: grabbing; }
.pcard-photo {
    width: 40px; height: 40px; border-radius: 50%;
    border: 2px solid #fff; overflow: hidden;
    box-shadow: 0 2px 5px rgba(0,0,0,0.35);
    background: #aaa;
}
.pcard-photo img { width: 100%; height: 100%; object-fit: cover; display: block; }
.pcard-name {
    font-size: 9px; font-weight: 700; color: #fff;
    text-shadow: 0 1px 2px #000;
    max-width: 52px; overflow: hidden;
    white-space: nowrap; text-overflow: ellipsis;
    text-align: center; margin-top: 2px;
}
.pcard-pos { font-size: 8px; color: #ddd; text-shadow: 0 1px 2px #000; }

/* ===== BANCO ===== */
.bench-wrap {
    background: #fff; border-radius: var(--radius);
    padding: 10px 12px; margin-top: 10px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.08);
    min-height: 90px;
}
.bench-wrap h5 { font-size: 0.82rem; color: #555; margin-bottom: 8px; }
.bench-slots {
    display: flex; flex-wrap: wrap; gap: 8px;
    min-height: 60px; padding: 4px;
    border: 2px dashed #ddd; border-radius: var(--radius);
}
.bench-slots.dragover { border-color: var(--primary); background: #e8f0fe; }

/* player card no banco */
.bcard {
    width: 56px; display: flex; flex-direction: column; align-items: center;
    cursor: grab; user-select: none; touch-action: none;
}
.bcard-photo {
    width: 42px; height: 42px; border-radius: 50%;
    border: 2px solid var(--primary); overflow: hidden; background: #ccc;
}
.bcard-photo img { width: 100%; height: 100%; object-fit: cover; display: block; }
.bcard-name { font-size: 9px; font-weight: 700; color: #333; text-align: center; margin-top: 2px; max-width: 56px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
.bcard-pos  { font-size: 8px; color: #777; text-align: center; }

/* ===== CSV PANEL ===== */
#panelCSV .card { margin-bottom: 12px; }

/* ===== DESKTOP overrides ===== */
@media (min-width: 768px) {
    .tabs { display: none; }
    .panel { display: block !important; }

    body { display: grid; grid-template-rows: auto 1fr; }
    .app-body {
        display: grid;
        grid-template-columns: 300px 1fr;
        gap: 16px; padding: 16px;
        align-items: start;
    }
    #panelCadastro { padding: 0; }
    #panelField    { padding: 0; }
    #panelCSV      { display: none !important; } /* CSV fica s√≥ no header no desktop */

    .pitch-wrap { padding-top: 75%; }
    .pitch-inner { flex-direction: row; } /* times lado a lado no desktop */
    .pitch-inner::after {
        top: 0; bottom: 0; left: 50%;
        right: auto; width: 2px; height: auto;
    }
    .pitch-inner::before {
        top: 50%; left: 50%;
        width: 80px; height: 80px;
    }
    .team-zone { border-bottom: none; border-right: 2px dashed rgba(255,255,255,0.3); }
    .team-zone:last-child { border-right: none; }

    .pitch-inner.three-teams::after { left: 33.33%; }
    .pcard { width: 60px; }
    .pcard-photo { width: 48px; height: 48px; }
    .pcard-name { font-size: 10px; max-width: 60px; }

    .header-controls { flex-wrap: nowrap; }
    .csv-desktop { display: flex !important; gap: 8px; align-items: center; }
}
.csv-desktop { display: none; }
.hidden { display: none !important; }
</style>
</head>
<body>

<header>
    <div class="header-title">‚öΩ Futebol de Ter√ßa</div>
    <div class="header-controls">
        <!-- CSV s√≥ aparece aqui no desktop -->
        <div class="csv-desktop">
            <input type="text" id="csvUrlDesktop" placeholder="URL Raw do CSV (GitHub)" style="width:220px">
            <button class="btn btn-outline" onclick="importCSV('csvUrlDesktop')">Carregar CSV</button>
            <button class="btn btn-outline" onclick="exportCSV()">Exportar CSV</button>
        </div>
    </div>
</header>

<!-- TABS mobile -->
<div class="tabs">
    <button class="tab-btn active" onclick="showTab('panelCadastro',this)">üë• Jogadores</button>
    <button class="tab-btn"        onclick="showTab('panelField',this)">‚öΩ Campo</button>
    <button class="tab-btn"        onclick="showTab('panelCSV',this)">üìé CSV</button>
</div>

<div class="app-body">

    <!-- ===== PAINEL CADASTRO ===== -->
    <div id="panelCadastro" class="panel active">

        <div class="card">
            <h4 id="formTitle">‚ûï Cadastrar Jogador</h4>
            <input type="hidden" id="editId">
            <div class="form-group" style="margin-bottom:6px">
                <label>Nome</label>
                <input type="text" id="pName" placeholder="Nome do jogador">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Posi√ß√£o</label>
                    <select id="pPos">
                        <option>Goleiro</option>
                        <option>Zagueiro</option>
                        <option>Lateral</option>
                        <option>Volante</option>
                        <option>Meio-campo</option>
                        <option>Atacante</option>
                    </select>
                </div>
            </div>
            <div class="form-group" style="margin-top:6px">
                <label>URL da Foto</label>
                <input type="text" id="pFoto" placeholder="https://lh3.googleusercontent.com/d/...">
            </div>
            <div class="btn-row">
                <button id="btnSave" class="btn btn-primary" style="flex:1" onclick="savePlayer()">Adicionar</button>
                <button id="btnCancel" class="btn btn-outline hidden" onclick="cancelEdit()">Cancelar</button>
            </div>
        </div>

        <div class="card">
            <h4>üìã Jogadores Cadastrados (<span id="playerCount">0</span>)</h4>
            <div id="playerList"></div>
        </div>
    </div>

    <!-- ===== PAINEL CAMPO ===== -->
    <div id="panelField" class="panel">

        <div class="field-controls">
            <span>Times:</span>
            <button id="btn2Times" class="btn btn-outline active btn-sm" onclick="setTeamsMode(2)">2 Times</button>
            <button id="btn3Times" class="btn btn-outline btn-sm"        onclick="setTeamsMode(3)">3 Times</button>
            <span style="margin-left:8px">Por time:</span>
            <input type="number" id="limitPerTeam" value="7" min="1" max="15" style="width:48px" onchange="updateSettings()">
        </div>

        <div class="pitch-wrap">
            <div class="pitch-inner" id="pitchInner">
                <div class="team-zone" id="zoneA" data-team="A">
                    <div class="team-label">TIME A</div>
                </div>
                <div class="team-zone" id="zoneB" data-team="B">
                    <div class="team-label">TIME B</div>
                </div>
                <div class="team-zone hidden" id="zoneC" data-team="C">
                    <div class="team-label">TIME C</div>
                </div>
                <div class="mid-line hidden" id="midLine3"></div>
            </div>
        </div>

        <div class="bench-wrap">
            <h5>ü™ë Banco de Reservas</h5>
            <div class="bench-slots" id="bench" data-team="bench"></div>
        </div>
    </div>

    <!-- ===== PAINEL CSV (MOBILE) ===== -->
    <div id="panelCSV" class="panel">
        <div class="card">
            <h4>üì• Carregar CSV do GitHub</h4>
            <div class="form-group" style="margin-bottom:8px">
                <label>URL Raw do CSV</label>
                <input type="text" id="csvUrlMobile" placeholder="https://raw.githubusercontent.com/...">
            </div>
            <button class="btn btn-primary" style="width:100%" onclick="importCSV('csvUrlMobile')">Carregar CSV</button>
        </div>
        <div class="card">
            <h4>üì§ Exportar CSV</h4>
            <p style="font-size:0.82rem;color:#666;margin-bottom:8px">
                Baixa o arquivo jogadores.csv com todos os jogadores cadastrados.
            </p>
            <button class="btn btn-green" style="width:100%" onclick="exportCSV()">Exportar CSV</button>
        </div>
    </div>

</div><!-- app-body -->

<script>
const FALLBACK = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='50' height='50'%3E%3Ccircle cx='25' cy='25' r='25' fill='%23aaa'/%3E%3Ccircle cx='25' cy='19' r='9' fill='%23fff'/%3E%3Cellipse cx='25' cy='40' rx='14' ry='10' fill='%23fff'/%3E%3C/svg%3E";

let players = [];
let config  = { teamsCount: 2, limitPerTeam: 7 };

/* INIT */
window.onload = () => {
    const sp = localStorage.getItem('ft_players');
    const sc = localStorage.getItem('ft_config');
    if (sp) players = JSON.parse(sp);
    if (sc) {
        config = JSON.parse(sc);
        document.getElementById('limitPerTeam').value = config.limitPerTeam;
    }
    applyTeamsMode(config.teamsCount);
    renderAll();
    initDropZones();
};

/* TABS */
function showTab(id, btn) {
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    btn.classList.add('active');
}

/* SETTINGS */
function updateSettings() {
    config.limitPerTeam = parseInt(document.getElementById('limitPerTeam').value) || 7;
    save();
}

function setTeamsMode(n) {
    config.teamsCount = n;
    players.forEach(p => { if (p.team === 'C') p.team = 'bench'; });
    applyTeamsMode(n);
    save();
    renderAll();
}

function applyTeamsMode(n) {
    config.teamsCount = n;
    document.getElementById('btn2Times').classList.toggle('active', n === 2);
    document.getElementById('btn3Times').classList.toggle('active', n === 3);
    const zC    = document.getElementById('zoneC');
    const inner = document.getElementById('pitchInner');
    const ml    = document.getElementById('midLine3');
    if (n === 3) {
        zC.classList.remove('hidden');
        ml.classList.remove('hidden');
        inner.classList.add('three-teams');
    } else {
        zC.classList.add('hidden');
        ml.classList.add('hidden');
        inner.classList.remove('three-teams');
    }
}

/* STORAGE */
function save() {
    localStorage.setItem('ft_players', JSON.stringify(players));
    localStorage.setItem('ft_config',  JSON.stringify(config));
}

/* CRUD */
function savePlayer() {
    const id   = document.getElementById('editId').value;
    const name = document.getElementById('pName').value.trim();
    const pos  = document.getElementById('pPos').value;
    const foto = document.getElementById('pFoto').value.trim();
    if (!name) return alert('Digite o nome do jogador');
    if (id) {
        const i = players.findIndex(p => p.id == id);
        players[i] = { ...players[i], name, position: pos, photoUrl: foto };
    } else {
        players.push({ id: Date.now(), name, position: pos, photoUrl: foto, team: 'bench', x: 10, y: 30 });
    }
    cancelEdit(); save(); renderAll();
}

function editPlayer(id) {
    const p = players.find(p => p.id == id);
    document.getElementById('editId').value = p.id;
    document.getElementById('pName').value  = p.name;
    document.getElementById('pPos').value   = p.position;
    document.getElementById('pFoto').value  = p.photoUrl;
    document.getElementById('btnSave').innerText = 'Salvar';
    document.getElementById('formTitle').innerText = '‚úèÔ∏è Editar Jogador';
    document.getElementById('btnCancel').classList.remove('hidden');
    document.getElementById('panelCadastro').scrollIntoView({behavior:'smooth'});
}

function cancelEdit() {
    document.getElementById('editId').value = '';
    document.getElementById('pName').value  = '';
    document.getElementById('pFoto').value  = '';
    document.getElementById('btnSave').innerText = 'Adicionar';
    document.getElementById('formTitle').innerText = '‚ûï Cadastrar Jogador';
    document.getElementById('btnCancel').classList.add('hidden');
}

function deletePlayer(id) {
    if (!confirm('Excluir este jogador?')) return;
    players = players.filter(p => p.id != id);
    save(); renderAll();
}

/* RENDER */
function renderAll() { renderSidebar(); renderBench(); renderField(); }

function imgSrc(url) { return (url && url.trim()) ? url.trim() : FALLBACK; }

function renderSidebar() {
    const list = document.getElementById('playerList');
    document.getElementById('playerCount').innerText = players.length;
    list.innerHTML = '';
    players.forEach(p => {
        const d = document.createElement('div');
        d.className = 'player-item';
        d.innerHTML = `
            <img class="avatar-sm" src="${imgSrc(p.photoUrl)}" onerror="this.onerror=null;this.src='${FALLBACK}'">
            <div class="player-info">
                <strong>${p.name}</strong>
                <small>${p.position} ${p.team !== 'bench' ? '¬∑ Time '+p.team : '¬∑ Banco'}</small>
            </div>
            <div class="player-actions">
                <button class="btn btn-outline btn-icon" onclick="editPlayer(${p.id})">‚úèÔ∏è</button>
                <button class="btn btn-danger btn-icon"  onclick="deletePlayer(${p.id})">üóëÔ∏è</button>
            </div>`;
        list.appendChild(d);
    });
}

function renderBench() {
    const bench = document.getElementById('bench');
    bench.innerHTML = '';
    players.filter(p => p.team === 'bench').forEach(p => {
        bench.appendChild(makeBCard(p));
    });
}

function renderField() {
    ['A','B','C'].forEach(t => {
        const z = document.getElementById('zone'+t);
        z.querySelectorAll('.pcard').forEach(c => c.remove());
    });
    players.filter(p => p.team !== 'bench').forEach(p => {
        const z = document.getElementById('zone'+p.team);
        if (z) z.appendChild(makePCard(p));
    });
}

/* CARDS */
function makePCard(p) {
    const c = document.createElement('div');
    c.className = 'pcard';
    c.dataset.id = p.id;
    c.style.left = (p.x || 10) + 'px';
    c.style.top  = (p.y || 30) + 'px';
    c.innerHTML = `
        <div class="pcard-photo"><img src="${imgSrc(p.photoUrl)}" onerror="this.onerror=null;this.src='${FALLBACK}'"></div>
        <div class="pcard-name">${p.name}</div>
        <div class="pcard-pos">${p.position.substring(0,3).toUpperCase()}</div>`;
    enableDrag(c);
    return c;
}

function makeBCard(p) {
    const c = document.createElement('div');
    c.className = 'bcard';
    c.dataset.id = p.id;
    c.innerHTML = `
        <div class="bcard-photo"><img src="${imgSrc(p.photoUrl)}" onerror="this.onerror=null;this.src='${FALLBACK}'"></div>
        <div class="bcard-name">${p.name}</div>
        <div class="bcard-pos">${p.position.substring(0,3).toUpperCase()}</div>`;
    enableDrag(c);
    return c;
}

/* DRAG & DROP (mouse + touch) */
let dragging = null, dragOffX = 0, dragOffY = 0, dragClone = null;

function enableDrag(el) {
    el.addEventListener('mousedown', startDragMouse);
    el.addEventListener('touchstart', startDragTouch, { passive: false });
}

function startDragMouse(e) {
    if (e.button !== 0) return;
    e.preventDefault();
    const el   = e.currentTarget;
    const rect = el.getBoundingClientRect();
    dragOffX   = e.clientX - rect.left;
    dragOffY   = e.clientY - rect.top;
    beginDrag(el, e.clientX, e.clientY);
    document.addEventListener('mousemove', onDragMove);
    document.addEventListener('mouseup',   onDragEnd);
}

function startDragTouch(e) {
    e.preventDefault();
    const t    = e.touches[0];
    const el   = e.currentTarget;
    const rect = el.getBoundingClientRect();
    dragOffX   = t.clientX - rect.left;
    dragOffY   = t.clientY - rect.top;
    beginDrag(el, t.clientX, t.clientY);
    document.addEventListener('touchmove', onTouchMove, { passive: false });
    document.addEventListener('touchend',  onTouchEnd);
}

function beginDrag(el, cx, cy) {
    dragging = el;
    dragClone = el.cloneNode(true);
    dragClone.style.cssText = `
        position:fixed; z-index:9999; pointer-events:none; opacity:0.85;
        left:${cx - dragOffX}px; top:${cy - dragOffY}px;
        width:${el.offsetWidth}px;`;
    document.body.appendChild(dragClone);
    el.style.opacity = '0.3';
}

function onDragMove(e)  { moveClone(e.clientX, e.clientY); }
function onTouchMove(e) { e.preventDefault(); moveClone(e.touches[0].clientX, e.touches[0].clientY); }

function moveClone(cx, cy) {
    if (!dragClone) return;
    dragClone.style.left = (cx - dragOffX) + 'px';
    dragClone.style.top  = (cy - dragOffY) + 'px';
}

function onDragEnd(e)  { finishDrag(e.clientX, e.clientY); document.removeEventListener('mousemove', onDragMove); document.removeEventListener('mouseup', onDragEnd); }
function onTouchEnd(e) { const t = e.changedTouches[0]; finishDrag(t.clientX, t.clientY); document.removeEventListener('touchmove', onTouchMove); document.removeEventListener('touchend', onTouchEnd); }

function finishDrag(cx, cy) {
    if (!dragging) return;

    if (dragClone) { dragClone.remove(); dragClone = null; }
    dragging.style.opacity = '1';

    const pid = dragging.dataset.id;
    const playerIdx = players.findIndex(p => p.id == pid);
    const player    = players[playerIdx];

    const el = document.elementFromPoint(cx, cy);
    const zone  = el ? el.closest('[data-team]') : null;
    const team  = zone ? zone.dataset.team : null;

    dragging = null;

    if (!team) return;

    if (team !== 'bench') {
        const count = players.filter(p => p.team === team && p.id != pid).length;
        if (count >= config.limitPerTeam) {
            alert(`Time ${team} j√° tem ${config.limitPerTeam} jogadores!`);
            renderAll(); return;
        }
        const rect = document.getElementById('zone'+team).getBoundingClientRect();
        player.x = Math.min(Math.max(cx - rect.left - dragOffX, 0), rect.width  - 55);
        player.y = Math.min(Math.max(cy - rect.top  - dragOffY, 20), rect.height - 65);
    }

    player.team = team;
    save();
    renderAll();
}

/* DROP ZONES highlight */
function initDropZones() {
    document.querySelectorAll('[data-team]').forEach(z => {
        z.addEventListener('dragover',  e => { e.preventDefault(); z.classList.add('dragover'); });
        z.addEventListener('dragleave', () => z.classList.remove('dragover'));
        z.addEventListener('drop',      () => z.classList.remove('dragover'));
    });
}

/* CSV */
async function importCSV(inputId) {
    const url = document.getElementById(inputId).value.trim();
    if (!url) return alert('Cole a URL Raw do GitHub');
    try {
        const text  = await (await fetch(url)).text();
        const lines = text.split('\n');
        const np = [];
        for (let i = 1; i < lines.length; i++) {
            const ln = lines[i].trim(); if (!ln) continue;
            const [nome, posicao, foto_url] = ln.split(',');
            np.push({
                id: Date.now()+i,
                name: (nome||'').trim(),
                position: (posicao||'Atacante').trim(),
                photoUrl: (foto_url||'').trim(),
                team:'bench', x:10, y:30
            });
        }
        if (np.length) {
            players = np; save(); renderAll();
            alert(`‚úÖ ${np.length} jogadores carregados!`);
        }
    } catch(err) {
        alert('Erro ao carregar CSV. Verifique a URL.');
        console.error(err);
    }
}

function exportCSV() {
    let csv = 'nome,posicao,foto_url\n';
    players.forEach(p => { csv += `${p.name},${p.position},${p.photoUrl}\n`; });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(new Blob([csv], {type:'text/csv;charset=utf-8;'}));
    a.download = 'jogadores.csv';
    document.body.appendChild(a); a.click(); document.body.removeChild(a);
}
</script>

</body>
</html>
